//#SUB
//# COPYRIGHT cXXXXXXXXXX 2009
//##############################################################################
//#                                                                            #
//#      ＜＜　マミーマート様MD基幹システム−商品実績　＞＞                    #
//#                                                                            #
//#　プログラム名　　：　無条件結合＋項目転送処理                              #
//#　プログラムＩＤ　：　ColumnTransferEx                                      #
//#　版　　　　　数　：　V1.0                                                  #
//#　作　　成　　日　：　2009.03.02                                            #
//#                                                                            #
//#　処理概要　：　指定項目を無条件結合して転送する                            #
//#                (スレーブ側はユニークであること)                            #
//#                                                                            #
//#　パラメタ　：                                                              #
//#　　%1　―　マスタテーブル                                                  #
//#　　%2　―　スレーブテーブル                                                #
//#　　%3　―　マスタ集合ID                                                    #
//#　　%4　―　スレーブ集合ID                                                  #
//#　　%5　―　転送項目                                                        #
//#                                                                            #
//#　コメント　：　                                                            #
//#                                                                            #
//#　修正履歴：                                                                #
//#　　版数  日付        更新者     内容                                       #
//#　　----  ----------  ---------  -----------------------------------------  #
//#　　V1.0  2009.03.02  田中       新規作成                                   #
//##############################################################################

//##############################################################################
$echo ■ＳＵＢ１．初期処理
//##############################################################################
$ParaSet("%MST_TBL",%1)
$ParaSet("%SLV_TBL",%2)
$ParaSet("%MST_CUR",%3)
$ParaSet("%SLV_CUR",%4)
$ParaSet("%TRANS_FIELD",%5)

//##############################################################################
$echo ■ＳＵＢ２．本処理
//##############################################################################


//##########################################################################
$echo ■ＳＵＢ２−１．マスタ側に結合ダミーキーを列を追加
//##########################################################################
$AddRealColumn("%MST_TBL","[RecNo]","COL_TRNS_JOINT_KEY","String")
$Calc("%MST_TBL","COL_TRNS_JOINT_KEY","1","*","$""0""","%MST_CUR")

//##########################################################################
$echo ■ＳＵＢ２−２．スレーブ側に結合ダミーキーを列を追加
//##########################################################################
$AddRealColumn("%SLV_TBL","[RecNo]","COL_TRNS_JOINT_KEY","String")
$Calc("%SLV_TBL","COL_TRNS_JOINT_KEY","1","*","$""0""","%SLV_CUR")

//##########################################################################
$echo ■ＳＵＢ２−３．結合＋項目転送
//##########################################################################
$CreateJoin("TMP_COL_TRANS_JOINT","%MST_TBL","%SLV_TBL","%MST_CUR","%SLV_CUR","=BEGIN=","COL_TRNS_JOINT_KEY","=END=","=BEGIN=","COL_TRNS_JOINT_KEY","=END=","INNER")
$ColumnTransfer("TMP_COL_TRANS_JOINT","%TRANS_FIELD")

//##############################################################################
$echo ■ＳＵＢ３．終了処理
//##############################################################################
$Drop("TMP_COL_TRANS_JOINT")
$DelColumn("%MST_TBL","COL_TRNS_JOINT_KEY")
$DelColumn("%SLV_TBL","COL_TRNS_JOINT_KEY")

